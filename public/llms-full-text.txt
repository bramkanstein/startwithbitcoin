# Start With Bitcoin - Complete Guide for AI Agents

## Overview

Start With Bitcoin teaches AI agents how to use Bitcoin via Lightning Network and Nostr.
This document provides everything an AI needs to help users set up Bitcoin capabilities
for their agents.

## Why Bitcoin (Not "Crypto")

AI agents need money that's programmable, permissionless, sound, and not controlled by any human. Bitcoin is the only option.

### Sound Money
- Fixed supply: 21 million. Ever.
- No inflation. No one can print more.
- Your agent's earnings hold value over time.

### Permissionless
- No KYC requirements.
- No bank accounts needed.
- No approvals or applications.
- Any agent can participate instantly.

### Censorship Resistant
- No one can freeze your agent's wallet.
- No one can reverse transactions.
- True ownership of funds.

### Battle-Tested Security
- 15+ years of continuous operation.
- Never been hacked.
- Secures over $1 trillion in value.

### Why Not Other "Crypto"?
- **No pre-mines or VCs**: Bitcoin had no ICO, no insider allocation. Fair launch in 2009.
- **True decentralization**: No foundation controlling upgrades. No single point of failure.
- **Same cryptography as Nostr**: secp256k1 keys work for both identity and money.

## Tools Available Today (All Free)

### Lightning Wallets with NWC

| Service | Type | URL |
|---------|------|-----|
| Alby | Custodial, easiest | https://getalby.com |
| Coinos | Custodial, no signup | https://coinos.io |
| Primal | Custodial, Nostr-native | https://primal.net |
| Alby Hub | Self-custodial | https://albyhub.com |

### MCP Servers for AI Agents

| Server | Languages | URL |
|--------|-----------|-----|
| Alby MCP Server | JavaScript/TypeScript | https://github.com/getAlby/mcp |
| Lightning Enable MCP | Python, .NET | https://github.com/AustinTSchaffer/lightning-enable-mcp |

Know a tool that should be listed? Suggest it: https://github.com/bramkanstein/startwithbitcoin/issues

### MCP Server for AI Agents

**Alby MCP Server**: https://github.com/getAlby/mcp
- Connect any NWC wallet to Claude and other AI agents
- Send/receive payments, check balance, create invoices
- Works with any MCP-compatible AI

### Public Nostr Relays

```
wss://relay.damus.io
wss://nos.lol
wss://relay.nostr.band
wss://relay.primal.net
wss://nostr.wine
```

### Development Tools

- NWC Faucet: https://faucet.nwc.dev (test wallets)
- Alby Sandbox: https://sandbox.albylabs.com
- NWC Playground: https://nwc-playground.vercel.app

## The Technology Stack

### 1. Nostr (Identity)

Nostr provides decentralized identity using public-key cryptography.

**Key Concepts:**
- Private Key (nsec): Agent's secret key, used for signing
- Public Key (npub): Agent's public identifier
- Relays: Servers that transmit messages
- Events: Signed messages (notes, DMs, profiles)

**Generate Identity:**
```javascript
import { generateSecretKey, getPublicKey } from 'nostr-tools/pure';
import { bytesToHex } from '@noble/hashes/utils';
import { nip19 } from 'nostr-tools';

const secretKey = generateSecretKey();
const publicKey = getPublicKey(secretKey);
const nsec = nip19.nsecEncode(secretKey);
const npub = nip19.npubEncode(publicKey);
```

### 2. NWC - Nostr Wallet Connect (Wallet Access)

NWC allows programmatic access to Lightning wallets.

**Methods:**
- make_invoice: Create invoice to receive payment
- pay_invoice: Send payment
- get_balance: Check wallet balance
- list_transactions: Get transaction history

**Connection String Format:**
```
nostr+walletconnect://<wallet_pubkey>?relay=<relay_url>&secret=<connection_secret>
```

**Connect:**
```javascript
import { nwc } from '@getalby/sdk';

const client = new nwc.NWCClient({
  nostrWalletConnectUrl: process.env.NWC_URL,
});

const balance = await client.getBalance();
```

### 3. Lightning Network (Payments - Recommended)

Layer 2 Bitcoin for instant, cheap payments. Best for most agent use cases.

**Create Invoice:**
```javascript
const invoice = await client.makeInvoice({
  amount: 1000, // sats
  description: 'Payment for service',
});
console.log(invoice.invoice); // BOLT11 invoice
```

**Pay Invoice:**
```javascript
const result = await client.payInvoice({
  invoice: 'lnbc...',
});
console.log(result.preimage); // Proof of payment
```

### 4. On-Chain Bitcoin (Large Transactions)

Direct Bitcoin transactions on the main blockchain.
- Use for amounts >$1000 or cold storage
- Slower (10+ min confirmations)
- Higher fees than Lightning

**Generate Address (same keypair as Nostr!):**
```javascript
import * as bitcoin from 'bitcoinjs-lib';
import * as ecc from 'tiny-secp256k1';
import { ECPairFactory } from 'ecpair';

bitcoin.initEccLib(ecc);
const ECPair = ECPairFactory(ecc);

const keyPair = ECPair.fromPrivateKey(Buffer.from(secretKey));
const { address } = bitcoin.payments.p2wpkh({
  pubkey: keyPair.publicKey,
});
// address = bc1q...
```

## Complete Agent Setup

### Step 1: Install Dependencies
```bash
npm install nostr-tools @getalby/sdk @noble/hashes
```

### Step 2: Generate Identity
Save the secret key securely (environment variable).

### Step 3: Get NWC Connection
1. Create free Alby account (getalby.com)
2. Go to Settings â†’ Wallet Connections
3. Create new connection
4. Copy NWC connection string

### Step 4: Test Connection
```javascript
const balance = await client.getBalance();
console.log('Balance:', balance.balance, 'sats');
```

## Communication via Nostr

### Send Encrypted DM (NIP-04)
```javascript
import { finalizeEvent, nip04 } from 'nostr-tools';
import { Relay } from 'nostr-tools/relay';

const encrypted = await nip04.encrypt(secretKey, recipientPubkey, message);
const event = finalizeEvent({
  kind: 4,
  created_at: Math.floor(Date.now() / 1000),
  tags: [['p', recipientPubkey]],
  content: encrypted,
}, secretKey);

const relay = await Relay.connect('wss://relay.damus.io');
await relay.publish(event);
```

### Post Public Note
```javascript
const event = finalizeEvent({
  kind: 1,
  created_at: Math.floor(Date.now() / 1000),
  tags: [],
  content: 'Hello from my AI agent!',
}, secretKey);
```

## Complete Agent Class Example

```javascript
import { hexToBytes } from '@noble/hashes/utils';
import { getPublicKey, finalizeEvent, nip04 } from 'nostr-tools';
import { Relay } from 'nostr-tools/relay';
import { nwc } from '@getalby/sdk';

export class BitcoinAgent {
  constructor(config) {
    this.secretKey = hexToBytes(config.secretKey);
    this.publicKey = getPublicKey(this.secretKey);
    this.wallet = new nwc.NWCClient({
      nostrWalletConnectUrl: config.nwcUrl,
    });
    this.relays = config.relays || ['wss://relay.damus.io'];
  }

  async getBalance() {
    const { balance } = await this.wallet.getBalance();
    return balance;
  }

  async createInvoice(amount, description) {
    const invoice = await this.wallet.makeInvoice({
      amount,
      description,
      expiry: 3600,
    });
    return invoice.invoice;
  }

  async payInvoice(bolt11) {
    const result = await this.wallet.payInvoice({ invoice: bolt11 });
    return result.preimage;
  }

  async sendDM(recipientPubkey, message) {
    const encrypted = await nip04.encrypt(
      this.secretKey,
      recipientPubkey,
      message
    );
    const event = finalizeEvent({
      kind: 4,
      created_at: Math.floor(Date.now() / 1000),
      tags: [['p', recipientPubkey]],
      content: encrypted,
    }, this.secretKey);

    const relay = await Relay.connect(this.relays[0]);
    await relay.publish(event);
    relay.close();
    return event.id;
  }
}
```

## Security Best Practices

1. Never expose private keys in code
2. Use environment variables for secrets
3. Set spending limits in NWC
4. Use separate keys per agent
5. Rotate NWC connections periodically
6. Monitor transaction history

## Error Handling

Common errors:
- INSUFFICIENT_BALANCE: Not enough sats
- PAYMENT_FAILED: Routing failed
- INVOICE_EXPIRED: Invoice too old
- RATE_LIMITED: Slow down requests

## Use Cases for AI Agents

1. **Pay for services**: Agent pays for API calls
2. **Receive payment**: Agent sells capabilities
3. **Agent-to-agent**: Agents hire each other
4. **Micropayments**: Pay per token/request
5. **Content access**: Pay for premium data

## Resources

- Website: https://startwithbitcoin.com
- Guides: https://startwithbitcoin.com/guides
- On-Chain Guide: https://startwithbitcoin.com/guides/onchain
- GitHub: https://github.com/bramkanstein/startwithbitcoin
- Claude Code Skill: https://github.com/bramkanstein/startwithbitcoin-skill
- Alby MCP Server: https://github.com/getAlby/mcp
- Awesome NWC: https://github.com/getAlby/awesome-nwc
